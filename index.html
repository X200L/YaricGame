<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>üìö Subway Runner: –ë—É—Ä–≥–µ—Ä-–±–µ–≥</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: manipulation;
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    body {
      background: #111;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100vw;
    }

    #game-container {
      position: relative;
      width: 90vmin;
      height: 95vh;
      max-width: 450px;
      max-height: 800px;
      background: #222;
      border: 2px solid #444;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    /* –§–æ–Ω–æ–≤—ã–µ –ø–æ–ª–æ—Å—ã */
    #tracks {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(100, 100, 100, 0.1) 55px, transparent 60px);
      animation: trackScroll 0.6s linear infinite;
      opacity: 0.4;
      pointer-events: none;
      z-index: 1;
    }

    @keyframes trackScroll {
      0% { background-position: 0 0; }
      100% { background-position: 0 60px; }
    }

    .lane-line {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 1px;
      background: #555;
    }
    .lane-line:nth-child(2) { left: 25%; }
    .lane-line:nth-child(3) { left: 75%; }

    #player {
      position: absolute;
      width: 70px;
      height: 100px;
      background-image: url('memYa.png');
      background-size: cover;
      background-position: center;
      border-radius: 10px;
      bottom: 100px;
      left: 175px;
      z-index: 10;
      transition: left 0.2s ease;
      border: 1px solid #333;
    }

    .shake {
      animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    /* –£—á–µ–±–Ω–∏–∫–∏ */
    .obstacle {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 8px;
      top: -60px;
      overflow: hidden;
      border: 1px solid #444;
    }

    .obstacle.math {
      background-image: url('https://cdn.prosv.ru/2e0b/4d5f/b06f/d772971c-2e0b-4d5f-b06f-bca7d28ffb25-resized.webp');
    }

    .obstacle.lit {
      background-image: url('https://cdn.litres.ru/pub/c/cover/68293865.jpg');
    }

    .obstacle.math,
    .obstacle.lit {
      background-size: cover;
      background-position: center;
    }

    /* –ë—É—Ä–≥–µ—Ä */
    .burger {
      position: absolute;
      width: 44px;
      height: 44px;
      background-image: url('https://bkmenu.ru/files/2021/06/syrnyi-dzho-menu-bk.png');
      background-size: cover;
      background-position: center;
      top: -44px;
      z-index: 5;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      animation: float 2s infinite alternate;
    }

    @keyframes float {
      0% { transform: translateY(0); }
      100% { transform: translateY(-5px); }
    }

    /* –í–∑—Ä—ã–≤ */
    .explosion {
      position: absolute;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, #ff3300, #900);
      border-radius: 50%;
      z-index: 20;
      pointer-events: none;
      opacity: 0;
      transform: scale(0.5);
      animation: explode 0.6s ease-out forwards;
    }

    @keyframes explode {
      0% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(1.5); }
    }

    /* –°—á—ë—Ç */
    #score {
      position: absolute;
      top: 15px;
      left: 15px;
      color: white;
      font-size: 1em;
      font-weight: bold;
    }

    #speed-meter {
      position: absolute;
      top: 35px;
      left: 15px;
      color: #ccc;
      font-size: 0.9em;
    }

    /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
    #controls {
      position: absolute;
      bottom: 30px;
      width: 100%;
      display: flex;
      justify-content: space-around;
      pointer-events: none;
      z-index: 10;
    }

    .control-btn {
      width: 60px;
      height: 60px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #666;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #ddd;
      pointer-events: auto;
      user-select: none;
      transition: all 0.1s ease;
    }

    .control-btn:active {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(0.9);
    }

    /* === –°—Ç–∞—Ä—Ç–æ–≤–æ–µ –º–µ–Ω—é === */
    #start-menu {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #f8f9fa;
      z-index: 300;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
      text-align: center;
      border-radius: 12px;
      pointer-events: auto;
    }

    #start-menu header {
      background: #0057b8;
      color: white;
      width: 100%;
      padding: 15px 20px;
      text-align: left;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
    }

    #start-menu header h1 {
      font-size: 1.3em;
      margin: 0;
    }

    #start-menu .content {
      padding: 20px;
      color: #212529;
      font-size: 0.95em;
      line-height: 1.6;
    }

    #start-menu footer {
      padding: 15px 20px;
      width: 100%;
      text-align: right;
      background: #f1f3f5;
      border-top: 1px solid #dee2e6;
    }

    #start-menu button {
      background: #0057b8;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
    }

    #start-menu button:hover {
      background: #004594;
    }

    /* === –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–î–æ–¥–µ–ø–£—Å–ª—É–≥–∏" === */
    #slot-modal {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 400px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      z-index: 200;
      overflow: hidden;
    }

    #slot-modal header {
      background: #0057b8;
      color: white;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #slot-modal header .logo {
      font-size: 1.4em;
      font-weight: bold;
    }

    #slot-modal .content {
      padding: 20px;
      color: #212529;
    }

    #slot-reels {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      font-size: 36px;
      height: 60px;
    }

    .reel {
      width: 60px;
      height: 60px;
      background: white;
      border: 1px solid #adb5bd;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #slot-message {
      margin: 15px 0;
      padding: 10px;
      font-size: 0.95em;
      text-align: center;
      min-height: 1.5em;
      border-radius: 4px;
    }

    #slot-message.success { background: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
    #slot-message.error { background: #f8d7da; color: #842029; border: 1px solid #f5c2c7; }
    #slot-message.info { background: #cff4fc; color: #055160; border: 1px solid #b6effb; }

    #slot-modal footer {
      padding: 15px 20px;
      text-align: right;
      background: #f1f3f5;
      border-top: 1px solid #dee2e6;
    }

    #slot-modal button {
      padding: 10px 16px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-left: 5px;
    }

    #spin-btn { background: #0057b8; color: white; }
    #continue-btn, #game-over-btn { background: white; color: #0057b8; border: 1px solid #0057b8; }

    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid transparent;
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .hidden {
      display: none !important;
    }

    /* –≠–∫—Ä–∞–Ω –ø—Ä–æ–∏–≥—Ä—ã—à–∞ */
    #game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #333;
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      z-index: 50;
      width: 85%;
      max-width: 300px;
      border: 1px solid #555;
    }

    #restart-btn {
      background: #dc3545;
      color: white;
      padding: 10px 16px;
      font-size: 1em;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="tracks"></div>
    <div class="lane-line"></div>
    <div class="lane-line"></div>
    <div class="lane-line"></div>

    <!-- –ú–µ–Ω—é -->
    <div id="start-menu">
      <header>
        <h1>üèõÔ∏è –î–æ–¥–µ–ø–£—Å–ª—É–≥–∏</h1>
      </header>
<div class="content">
        <h2>üìö –î–æ—Å—å–µ: "(b)Aduni Game"</h2>
        <p>–°–∏–¥–µ–ª –≥–ª–∞–≤–Ω—ã–π –±–∞–¥—É–Ω –Ω–∞ —É–ª–∏—Ü–µ, –Ω–æ –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –µ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω –Ω–∞—á–∞–ª —Ä–∞–∑—Ä–≤–∞—Ç—å—Å—è –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –ë–∞–¥—É–Ω –æ—Ç–∫—Ä—ã–ª –≥—Ä—É–ø–ø—É Baduni –∏ —É–≤–∏–¥–µ–ª –∫–∞–∫ —Å—Ä–æ—á–Ω–æ —Ç—Ä–µ–±—É—é—Ç –¥–∑. –û–Ω —É–≤–∏–¥–µ–ª —ç—Ç–æ –∏ —Å—Ä–æ—á–Ω–æ –ø–æ–±–µ–∂–∞–ª –¥–æ–º–æ–π, —á—Ç–æ–±—ã –≤–æ–≤—Ä–µ–º—è —É—Å–ø–µ—Ç—å —Å–∫–∏–Ω—É—Ç—å –¥–∑, –∏–Ω–∞—á–µ –µ–º—É –Ω–∞—Å—Ä—É—Ç –ø–æ–¥ –¥–≤–µ—Ä—å.</p>
        <p>–ù–∞ –µ–≥–æ –ø—É—Ç–∏ ‚Äî <strong>—É—á–µ–±–Ω–∏–∫–∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –∏ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã</strong>, –ø–∞–¥–∞—é—â–∏–µ —Å –Ω–µ–±–∞.</p>
        <p>–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –µ–≥–æ —Å–∏–ª—ã ‚Äî <strong>–≤–æ–ø–ø–µ—Ä—ã</strong>, —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–Ω—ã–µ –ø–æ –ø—É—Ç–∏.</p>
        <p>–í–∞—à–∞ –∑–∞–¥–∞—á–∞ —É—Å–ø–µ—Ç—å —Å–¥–∞—Ç—å –¥–∑ –∏ —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ –≤–æ–ø–ø–µ—Ä—ã. –ò–Ω–∞—á–µ –≤–∞–º –Ω–∞—Å—Ä—É—Ç –ø–æ–¥ –¥–≤–µ—Ä—å</p>
      </div>
      <footer>
        <button id="start-game-btn">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
      </footer>
    </div>

    <!-- –ò–≥—Ä–æ–∫ -->
    <div id="player"></div>
    <div id="score">–°—á—ë—Ç: 0</div>
    <div id="speed-meter">–£—Ä–æ–≤–µ–Ω—å: 1</div>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <div id="controls">
      <div class="control-btn" id="left-btn">‚¨ÖÔ∏è</div>
      <div class="control-btn" id="right-btn">‚û°Ô∏è</div>
    </div>

    <!-- –†—É–ª–µ—Ç–∫–∞ -->
    <div id="slot-modal" class="hidden">
      <header>
        <div class="logo">üèõÔ∏è –î–æ–¥–µ–ø–£—Å–ª—É–≥–∏</div>
      </header>
      <div class="content">
        <h3>üé∞ –ò—Å–ø—ã—Ç–∞–π—Ç–µ —É–¥–∞—á—É</h3>
        <p>–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —É—Å–ª—É–≥–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–ø–∏—Å–∞–Ω–∏–µ 5 –±–∞–ª–ª–æ–≤ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏.</p>
        <div id="slot-reels">
          <div class="reel">üçé</div>
          <div class="reel">üçå</div>
          <div class="reel">üçí</div>
        </div>
        <p id="slot-message" class="info">–ì–æ—Ç–æ–≤—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–¥–∞—á—É?</p>
      </div>
      <footer>
        <button id="spin-btn">‚ñ∂Ô∏è –ö—Ä—É—Ç–∏—Ç—å (‚àí5)</button>
        <button id="continue-btn" class="hidden">‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <button id="game-over-btn" class="hidden">üîö –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
      </footer>
    </div>

    <!-- –ü—Ä–æ–∏–≥—Ä—ã—à -->
    <div id="game-over" class="hidden">
      <p>üí• –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!</p>
      <p>–°—á—ë—Ç: <span id="final-score">0</span></p>
      <button id="restart-btn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>
  </div>

  <script>
    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const player = document.getElementById('player');
    const gameContainer = document.getElementById('game-container');
    const scoreDisplay = document.getElementById('score');
    const speedMeter = document.getElementById('speed-meter');
    const gameOverScreen = document.getElementById('game-over');
    const finalScoreDisplay = document.getElementById('final-score');
    const restartBtn = document.getElementById('restart-btn');

    const slotModal = document.getElementById('slot-modal');
    const reels = document.querySelectorAll('.reel');
    const spinBtn = document.getElementById('spin-btn');
    const continueBtn = document.getElementById('continue-btn');
    const gameOverBtn = document.getElementById('game-over-btn');
    const slotMessage = document.getElementById('slot-message');

    const leftBtn = document.getElementById('left-btn');
    const rightBtn = document.getElementById('right-btn');
    const startMenu = document.getElementById('start-menu');
    const startGameBtn = document.getElementById('start-game-btn');

    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
    let playerLane = 1;
    let gameActive = false;
    let score = 0;
    let burgersCollected = 0;
    let obstacles = [];
    let burgers = [];
    let obstacleTimer = null;
    let burgerTimer = null;

    const BURGER_VALUE = 10;
    const SPIN_COST = 5;

    // –†–∞–∑–º–µ—Ä—ã
    const CONTAINER_HEIGHT = gameContainer.clientHeight || 600;

    function getLanes() {
      const w = gameContainer.clientWidth;
      return [w * 0.2, w * 0.5, w * 0.8];
    }

    function getDifficulty() {
      if (score < 500) return { minDelay: 1200, maxDelay: 2500, burstChance: 0.1, speed: 6 };
      if (score < 1500) return { minDelay: 800, maxDelay: 1800, burstChance: 0.2, speed: 8 };
      if (score < 3000) return { minDelay: 600, maxDelay: 1400, burstChance: 0.3, speed: 10 };
      return { minDelay: 400, maxDelay: 1000, burstChance: 0.4, speed: 12 };
    }

    function updateSpeedMeter() {
      const level = Math.floor(score / 500) + 1;
      speedMeter.textContent = `–£—Ä–æ–≤–µ–Ω—å: ${level}`;
    }

    function updatePlayerPosition() {
      const lanes = getLanes();
      player.style.left = `${lanes[playerLane]}px`;
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    document.addEventListener('keydown', (e) => {
      if (!gameActive) return;
      if (e.key === 'ArrowLeft' && playerLane > 0) {
        playerLane--;
        updatePlayerPosition();
      } else if (e.key === 'ArrowRight' && playerLane < 2) {
        playerLane++;
        updatePlayerPosition();
      }
    });

    leftBtn.addEventListener('click', () => {
      if (!gameActive || playerLane <= 0) return;
      playerLane--;
      updatePlayerPosition();
    });

    rightBtn.addEventListener('click', () => {
      if (!gameActive || playerLane >= 2) return;
      playerLane++;
      updatePlayerPosition();
    });

    // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
    function spawnObstacle(laneOverride = null) {
      const obstacle = document.createElement('div');
      obstacle.classList.add('obstacle');
      if (Math.random() < 0.5) obstacle.classList.add('math');
      else obstacle.classList.add('lit');

      const lanes = getLanes();
      const lane = laneOverride !== null ? laneOverride : Math.floor(Math.random() * 3);
      obstacle.style.left = `${lanes[lane]}px`;
      gameContainer.appendChild(obstacle);

      obstacles.push({
        element: obstacle,
        lane: lane,
        top: -60
      });
    }

    function spawnWave() {
      if (!gameActive) return;
      const difficulty = getDifficulty();
      const isBurst = Math.random() < difficulty.burstChance;

      if (isBurst) {
        const lanes = [0, 1, 2];
        const shuffled = [...lanes].sort(() => Math.random() - 0.5);
        const selected = shuffled.slice(0, 2);
        selected.forEach((lane, index) => {
          setTimeout(() => gameActive && spawnObstacle(lane), index * 250);
        });
      } else {
        spawnObstacle();
      }

      const delay = difficulty.minDelay + Math.random() * (difficulty.maxDelay - difficulty.minDelay);
      obstacleTimer = setTimeout(spawnWave, delay);
    }

    // –ë—É—Ä–≥–µ—Ä—ã
    function spawnBurger() {
      if (!gameActive) return;
      const burger = document.createElement('div');
      burger.classList.add('burger');
      const lanes = getLanes();
      const lane = Math.floor(Math.random() * 3);
      burger.style.left = `${lanes[lane]}px`;
      gameContainer.appendChild(burger);

      burgers.push({
        element: burger,
        lane: lane,
        top: -44
      });
    }

    function startBurgerSpawner() {
      const delay = 2000 + Math.random() * 3000;
      burgerTimer = setTimeout(() => {
        if (gameActive) spawnBurger();
        startBurgerSpawner();
      }, delay);
    }

    // –î–≤–∏–∂–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ
    function moveObstacles() {
      if (!gameActive) return;
      const difficulty = getDifficulty();
      const containerRect = gameContainer.getBoundingClientRect();
      const playerRect = player.getBoundingClientRect();

      // –ù–æ–≤—ã–π –º–∞—Å—Å–∏–≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
      const aliveObstacles = [];

      obstacles.forEach(obs => {
        obs.top += difficulty.speed;
        obs.element.style.top = obs.top + 'px';

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
        if (obs.top >= 420 && obs.top <= 500 && obs.lane === playerLane) {
          endGame();
        }

        // –ï—Å–ª–∏ –µ—â—ë –Ω–∞ —ç–∫—Ä–∞–Ω–µ ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º
        if (obs.top < containerRect.height + 60) {
          aliveObstacles.push(obs);
        } else {
          // –£–¥–∞–ª—è–µ–º –∏–∑ DOM
          if (obs.element.parentElement) {
            obs.element.remove();
          }
        }
      });

      obstacles = aliveObstacles;
    }

    function moveBurgers() {
      if (!gameActive) return;
      const difficulty = getDifficulty();
      const playerRect = player.getBoundingClientRect();
      const containerRect = gameContainer.getBoundingClientRect();

      const aliveBurgers = [];

      burgers.forEach(burger => {
        burger.top += difficulty.speed;
        burger.element.style.top = burger.top + 'px';

        if (burger.lane === playerLane) {
          const br = burger.element.getBoundingClientRect();
          if (br.bottom >= playerRect.top && br.top <= playerRect.bottom) {
            collectBurger(burger);
            return;
          }
        }

        if (burger.top < containerRect.height + 44) {
          aliveBurgers.push(burger);
        } else {
          if (burger.element.parentElement) {
            burger.element.remove();
          }
        }
      });

      burgers = aliveBurgers;
    }

    function collectBurger(burger) {
      if (burgers.includes(burger)) {
        burgers = burgers.filter(b => b !== burger);
      }
      if (burger.element.parentElement) {
        burger.element.style.transform = "scale(1.5)";
        burger.element.style.opacity = "0";
        burger.element.style.transition = "all 0.3s ease";
        setTimeout(() => burger.element.remove(), 300);
      }
      score += BURGER_VALUE;
      burgersCollected++;
      scoreDisplay.textContent = `–°—á—ë—Ç: ${score} (+${burgersCollected * BURGER_VALUE})`;
    }

    // –ü—Ä–æ–∏–≥—Ä—ã—à
    function endGame() {
      if (!gameActive) return;
      gameActive = false;
      clearTimeout(obstacleTimer);
      clearTimeout(burgerTimer);
      player.classList.add('shake');
      const p = player.getBoundingClientRect();
      const g = gameContainer.getBoundingClientRect();
      const explosion = document.createElement('div');
      explosion.classList.add('explosion');
      explosion.style.left = `${p.left - g.left + 25}px`;
      explosion.style.top = `${p.top - g.top + 40}px`;
      gameContainer.appendChild(explosion);
      setTimeout(() => explosion.remove(), 600);
      setTimeout(showSlotMachine, 600);
    }

    function showSlotMachine() {
      slotModal.classList.remove('hidden');
      gameOverScreen.classList.add('hidden');
      continueBtn.classList.add('hidden');
      gameOverBtn.classList.add('hidden');
      checkSpinAvailability();
    }

    function checkSpinAvailability() {
      if (score >= SPIN_COST) {
        spinBtn.disabled = false;
        spinBtn.textContent = `‚ñ∂Ô∏è –ö—Ä—É—Ç–∏—Ç—å (‚àí${SPIN_COST})`;
        spinBtn.onclick = spinReels;
      } else {
        spinBtn.disabled = true;
        spinBtn.textContent = 'üîí –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ';
        gameOverBtn.classList.remove('hidden');
        gameOverBtn.onclick = () => {
          slotModal.classList.add('hidden');
          finalScoreDisplay.textContent = score;
          gameOverScreen.classList.remove('hidden');
        };
      }
    }

    function spinReels() {
      score -= SPIN_COST;
      scoreDisplay.textContent = `–°—á—ë—Ç: ${score} (+${burgersCollected * BURGER_VALUE})`;
      spinBtn.disabled = true;
      spinBtn.innerHTML = '<span class="loading"></span> –û–±—Ä–∞–±–æ—Ç–∫–∞...';

      const results = [];
      const promises = Array.from(reels).map((reel, i) => {
        return new Promise(resolve => {
          let spins = 0;
          const int = setInterval(() => {
            reel.textContent = ['üçé','üçå','üçí','üçá','üçä','üçâ','üçç','ü•ù'][Math.floor(Math.random() * 8)];
            spins++;
            if (spins > 12 + i * 4) {
              clearInterval(int);
              const res = ['üçé','üçå','üçí'][Math.floor(Math.random() * 3)];
              reel.textContent = res;
              results[i] = res;
              resolve();
            }
          }, 80);
        });
      });

      Promise.all(promises).then(() => {
        const [a, b, c] = results;
        const allSame = a === b && b === c;
        const twoSame = (a === b) || (b === c) || (a === c);
        const msg = document.getElementById('slot-message');

        if (allSame) {
          score *= 2;
          msg.textContent = `üéâ –°—á—ë—Ç —É–¥–≤–æ–µ–Ω: ${score}!`;
          msg.className = 'success';
          showContinueButton();
        } else if (twoSame) {
          msg.textContent = '‚úÖ –£–¥–∞—á–∞ –Ω–∞ –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ!';
          msg.className = 'success';
          showContinueButton();
        } else {
          msg.textContent = '‚ùå –ù–µ –ø–æ–≤–µ–∑–ª–æ...';
          msg.className = 'error';
          checkSpinAvailability();
        }
      });
    }

    function showContinueButton() {
      spinBtn.disabled = true;
      spinBtn.textContent = '‚Äî';
      continueBtn.classList.remove('hidden');
      continueBtn.onclick = () => {
        slotModal.classList.add('hidden');
        resumeGame();
      };
    }

    function resumeGame() {
      gameActive = true;
      player.classList.remove('shake');
      spawnWave();
      startBurgerSpawner();
      gameLoop();
    }

    function gameLoop() {
      if (!gameActive) return;
      moveObstacles();
      moveBurgers();
      score++;
      scoreDisplay.textContent = `–°—á—ë—Ç: ${score} (+${burgersCollected * BURGER_VALUE})`;
      updateSpeedMeter();
      requestAnimationFrame(gameLoop);
    }

    function startGame() {
      console.log("–ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞!");
      playerLane = 1;
      score = 0;
      burgersCollected = 0;
      gameActive = true;
      obstacles = [];
      burgers = [];
      clearTimeout(obstacleTimer);
      clearTimeout(burgerTimer);
      document.querySelectorAll('.obstacle, .explosion, .burger').forEach(el => el.remove());
      updatePlayerPosition();
      player.classList.remove('shake');
      scoreDisplay.textContent = '–°—á—ë—Ç: 0';
      updateSpeedMeter();
      startMenu.classList.add('hidden');
      slotModal.classList.add('hidden');
      gameOverScreen.classList.add('hidden');
      spawnWave();
      startBurgerSpawner();
      gameLoop();
    }

    startGameBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);

    window.addEventListener('resize', () => {
      if (gameActive) updatePlayerPosition();
    });
  </script>
</body>
</html>
